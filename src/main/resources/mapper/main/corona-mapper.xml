<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >

<mapper namespace="corona">

	<insert id="insertCorona" parameterType="HashMap">
		INSERT INTO TCORONA /* insertCorona as MainController */
		  (CITY,
		   DEF_CNT,
		   INC_DEC,
		   DEATH_CNT,
		   ISOL_ING_CNT,
		   ISOL_CLEAR_CNT,
		   OVER_FLOW_CNT,
		   LOCAL_OCC_CNT,
		   STD_DAY,
		   INSERT_DATE,
		   MODIFY_DATE)
		VALUES
		  (#{city, jdbcType=VARCHAR},
		   #{defCnt, jdbcType=NUMERIC},
		   #{incDec, jdbcType=NUMERIC},
		   #{deathCnt, jdbcType=NUMERIC},
		   #{isolIngCnt, jdbcType=NUMERIC},
		   #{isolClearCnt, jdbcType=NUMERIC},
		   #{overFlowCnt, jdbcType=NUMERIC},
		   #{localOccCnt, jdbcType=NUMERIC},
		   #{stdDay, jdbcType=VARCHAR},
		   SYSDATE,
		   SYSDATE)
	</insert>

	<select id="selectCorona" resultType="HashMap">
		SELECT  /* selectCorona as MainController */
		       A.CITY,
		       A.DEF_CNT,
		       A.INC_DEC,
		       A.DEATH_CNT,
		       A.ISOL_ING_CNT,
		       A.ISOL_CLEAR_CNT,
		       A.OVER_FLOW_CNT,
		       A.LOCAL_OCC_CNT,
		       A.STD_DAY,
		       A.OVER_FLOW_CNT + A.LOCAL_OCC_CNT AS INF_CNT,
               ROW_NUMBER() OVER (ORDER BY LOCAL_OCC_CNT) AS RANK
		  FROM TCORONA A
         WHERE TO_CHAR(A.INSERT_DATE, 'yyyymmddhh24mi') >= (SELECT TO_CHAR(MAX(B.INSERT_DATE - 1/24/60), 'yyyymmddhh24mi') FROM TCORONA B)
         GROUP BY A.CITY, A.DEF_CNT, A.INC_DEC, A.DEATH_CNT, A.ISOL_ING_CNT, A.ISOL_CLEAR_CNT, A.OVER_FLOW_CNT, A.LOCAL_OCC_CNT, A.STD_DAY
         ORDER BY RANK DESC
	</select>

	<select id="selectCoronaDate" resultType="HashMap" parameterType="String">
		SELECT /* selectCoronaDate as MainController */
		     A.CITY,
		     A.DEF_CNT,
		     A.INC_DEC,
		     A.DEATH_CNT,
		     A.ISOL_ING_CNT,
		     A.ISOL_CLEAR_CNT,
		     A.OVER_FLOW_CNT,
		     A.LOCAL_OCC_CNT,
		     A.STD_DAY,
		     A.OVER_FLOW_CNT + A.LOCAL_OCC_CNT AS INF_CNT,
	         ROW_NUMBER() OVER (ORDER BY LOCAL_OCC_CNT) AS RANK
		FROM TCORONA A
		   WHERE A.INSERT_DATE > TO_DATE(#{date, jdbcType=VARCHAR}, 'yyyymmdd') AND A.INSERT_DATE &lt; TO_DATE(#{date, jdbcType=VARCHAR}, 'yyyymmdd') + 1
		   GROUP BY A.CITY, A.DEF_CNT, A.INC_DEC, A.DEATH_CNT, A.ISOL_ING_CNT, A.ISOL_CLEAR_CNT, A.OVER_FLOW_CNT, A.LOCAL_OCC_CNT, A.STD_DAY
		   ORDER BY RANK DESC
	</select>
</mapper>